<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>blendsky — Forum for Blender users sharing JSON geometry node setups</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;1,9..144,400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <a href="#" class="logo" data-nav="home">
      <span class="logo-mark">blend</span><span class="logo-dot">sky</span>
    </a>
    <p class="tagline">Blender users sharing JSON geometry node setups</p>
    <nav class="main-nav">
      <a href="#" class="nav-link" data-nav="wiki">Wiki</a>
      <a href="#" class="nav-link" data-nav="forum">Forum</a>
      <a href="#" class="nav-link" data-nav="bluesky">Bluesky</a>
    </nav>
  </header>

  <main class="main">
    <!-- Home -->
    <section id="view-home" class="view view-active">
      <section class="home-section home-recent-section">
        <h2 class="home-section-title">Recent forum posts &amp; wiki articles</h2>
        <p id="home-recent-desc" class="home-section-desc muted">Your latest wiki pages and forum threads.</p>
        <div id="home-recent-feed" class="home-recent-feed"></div>
      </section>

      <section class="home-section home-carousel-section">
        <h2 class="home-section-title">Trending #b3d</h2>
        <p class="home-section-desc muted">Recent Blender posts on Bluesky.</p>
        <div class="home-carousel-wrap">
          <div id="home-discover-feed" class="home-carousel-track">
            <p class="muted" id="home-discover-loading">Loading…</p>
          </div>
          <a href="https://bsky.app/search?q=%23b3d" target="_blank" rel="noopener" class="home-carousel-more">See more #b3d on Bluesky →</a>
        </div>
      </section>

      <section id="home-bluesky-section" class="home-section home-feed-section hidden">
        <h2 class="home-section-title">Your Bluesky feed</h2>
        <p class="home-section-desc muted">Posts from people you follow.</p>
        <div id="home-bluesky-feed" class="home-bluesky-feed"></div>
        <button type="button" id="home-bluesky-load-more" class="btn btn-secondary hidden">Load more</button>
      </section>

      <section class="home-section home-actions">
        <p class="home-actions-lead">Wiki · Forum · Bluesky</p>
        <p class="home-actions-sub muted">Document node setups, share threads, and connect your feed.</p>
        <nav class="home-actions-nav">
          <a href="#" class="btn btn-primary" data-nav="wiki">Wiki</a>
          <a href="#" class="btn btn-secondary" data-nav="forum">Forum</a>
          <a href="#" class="btn btn-secondary" data-nav="bluesky">Bluesky</a>
        </nav>
      </section>
    </section>

    <!-- Wiki (Wikipedia-style) -->
    <section id="view-wiki" class="view view-wiki">
      <div class="wiki-toolbar wiki-toolbar-wikipedia">
        <div class="wiki-toolbar-inner">
          <input type="text" id="wiki-search" class="wiki-search" placeholder="Search or create page…" />
          <button type="button" id="wiki-new" class="btn btn-primary">New page</button>
        </div>
      </div>
      <div class="wiki-content wiki-content-wikipedia">
        <aside class="wiki-sidebar wiki-sidebar-wikipedia">
          <div class="wiki-sidebar-inner">
            <h3 class="wiki-sidebar-title">Contents</h3>
            <ul id="wiki-list" class="wiki-list"></ul>
          </div>
        </aside>
        <article class="wiki-main wiki-main-wikipedia">
          <div id="wiki-view" class="wiki-view">
            <h1 id="wiki-title"></h1>
            <p id="wiki-sync-status" class="sync-status" aria-live="polite"></p>
            <p class="wiki-edits-hint muted"><small>Edits sync to Bluesky. Remix creates a fork. Request edit opens Bluesky compose.</small></p>
            <div id="wiki-body" class="wiki-body"></div>
            <div class="wiki-view-actions">
              <button type="button" id="wiki-edit-btn" class="btn btn-secondary">Edit</button>
              <button type="button" id="wiki-sync-bluesky" class="btn btn-secondary">Sync to Bluesky</button>
              <button type="button" id="wiki-request-edit" class="btn btn-ghost hidden">Request edit</button>
              <button type="button" id="wiki-remix" class="btn btn-secondary">Remix</button>
            </div>
          </div>
          <div id="wiki-edit" class="wiki-edit hidden">
            <input type="text" id="wiki-edit-title" class="wiki-edit-title" placeholder="Page title" />
            <textarea id="wiki-edit-body" class="wiki-edit-body" placeholder="Write in Markdown…"></textarea>
            <div class="wiki-edit-actions">
              <button type="button" id="wiki-save" class="btn btn-primary">Save</button>
              <button type="button" id="wiki-cancel" class="btn btn-ghost">Cancel</button>
            </div>
          </div>
        </article>
      </div>
      <div id="wiki-from-others" class="wiki-from-others">
        <h3>Wiki articles from others</h3>
        <p class="wiki-from-others-hint muted">Posts with <strong>#blendsky-wiki</strong>. Author DID and Bluesky profile linked.</p>
        <div id="wiki-from-others-feed" class="wiki-from-others-feed"><p class="muted" id="wiki-from-others-loading">Loading…</p></div>
      </div>
    </section>

    <!-- Forum -->
    <section id="view-forum" class="view">
      <div class="forum-toolbar">
        <h2>Forum</h2>
        <p class="forum-tagline">Start a thread, reply to others, and sync to Bluesky so the community can find you. Geometry node JSON is optional.</p>
        <button type="button" id="forum-new-thread" class="btn btn-primary">New thread</button>
      </div>
      <div id="forum-discover" class="forum-discover">
        <h3>Forum posts from the community</h3>
        <p class="forum-discover-hint muted">Posts from others using the <strong>app.blendsky.document</strong> lexicon and <strong>#blendsky-forum</strong>. Reply in the forum below. To add a thread from someone else, click a card to import and open it, or paste its AT URI below.</p>
        <div id="forum-discover-feed" class="forum-discover-feed"><p class="muted" id="forum-discover-loading">Loading…</p></div>
      </div>
      <h3 class="forum-your-threads-title">Your threads</h3>
      <div id="forum-thread-list" class="forum-thread-list"></div>
      <div id="forum-thread-view" class="forum-thread-view hidden">
        <button type="button" id="forum-back" class="btn btn-ghost">← Back to threads</button>
        <article id="forum-thread-detail"></article>
        <div id="forum-thread-standard" class="forum-thread-standard hidden">
          <button type="button" id="forum-edit-thread-btn" class="btn btn-secondary">Edit thread</button>
          <button type="button" id="forum-export-standard" class="btn btn-secondary">Export as document</button>
          <button type="button" id="forum-sync-bluesky" class="btn btn-secondary">Sync to Bluesky</button>
        </div>
        <section class="forum-replies">
          <h3>Replies</h3>
          <p class="forum-replies-hint muted"><small>Replies stay in the blendsky forum. Add images with the button below.</small></p>
          <ul id="forum-replies-list"></ul>
          <form id="forum-reply-form" class="forum-reply-form">
            <textarea id="forum-reply-body" placeholder="Write a reply…" rows="3"></textarea>
            <p class="form-actions-inline">
              <input type="file" id="forum-reply-image" accept="image/jpeg,image/png,image/gif,image/webp" class="forum-image-input" />
              <label for="forum-reply-image" class="btn btn-secondary forum-upload-label">Add image</label>
            </p>
            <button type="submit" class="btn btn-primary">Reply</button>
          </form>
        </section>
      </div>
      <div id="forum-new-view" class="forum-new-view hidden">
        <button type="button" id="forum-new-cancel" class="btn btn-ghost">← Cancel</button>
        <form id="forum-new-form" class="forum-new-form">
          <label class="form-label">Title</label>
          <input type="text" id="forum-new-title" class="form-input" placeholder="What's this thread about?" required />
          <label class="form-label">Your post</label>
          <textarea id="forum-new-body" class="form-input form-textarea" placeholder="What's on your mind? You can paste a geometry node JSON or add images." rows="5"></textarea>
          <p class="form-actions-inline">
            <input type="file" id="forum-new-image" accept="image/jpeg,image/png,image/gif,image/webp" class="forum-image-input" />
            <label for="forum-new-image" class="btn btn-secondary forum-upload-label">Add image</label>
          </p>
          <p class="form-hint muted">This will appear on the forum. Sync to Bluesky to share it there.</p>
          <details class="form-optional">
            <summary>Optional</summary>
            <label class="form-label form-label-optional">Link name</label>
            <input type="text" id="forum-new-path" class="form-input form-input-optional" placeholder="Short name for the link (e.g. my-setup)" />
            <label class="form-label form-label-optional">Short description</label>
            <textarea id="forum-new-description" class="form-input form-input-optional" placeholder="One line summary" rows="2"></textarea>
            <label class="form-label form-label-optional">Tags</label>
            <input type="text" id="forum-new-tags" class="form-input form-input-optional" placeholder="blender, nodes" />
          </details>
          <button type="submit" class="btn btn-primary">Create thread</button>
        </form>
      </div>
      <div id="forum-edit-view" class="forum-edit-view hidden">
        <button type="button" id="forum-edit-cancel" class="btn btn-ghost">← Cancel</button>
        <form id="forum-edit-form" class="forum-edit-form">
          <label class="form-label">Title</label>
          <input type="text" id="forum-edit-title" class="form-input" placeholder="Thread title" required />
          <label class="form-label">Your post</label>
          <textarea id="forum-edit-body" class="form-input form-textarea" placeholder="Your post or geometry node JSON" rows="5"></textarea>
          <p class="form-actions-inline">
            <input type="file" id="forum-edit-image" accept="image/jpeg,image/png,image/gif,image/webp" class="forum-image-input" />
            <label for="forum-edit-image" class="btn btn-secondary forum-upload-label">Add image</label>
          </p>
          <details class="form-optional">
            <summary>Optional</summary>
            <input type="text" id="forum-edit-path" class="form-input form-input-optional" placeholder="Link name" />
            <textarea id="forum-edit-description" class="form-input form-input-optional" placeholder="Short description" rows="2"></textarea>
            <input type="text" id="forum-edit-tags" class="form-input form-input-optional" placeholder="Tags" />
          </details>
          <button type="submit" class="btn btn-primary">Save & sync to Bluesky</button>
        </form>
      </div>
      <div class="forum-import-export">
        <p class="forum-std-hint">Import forum or wiki documents from the AT Protocol. Paste an AT URI (<strong>app.blendsky.document</strong>).</p>
        <div class="forum-import-row">
          <input type="text" id="forum-import-uri" placeholder="at://did:plc:…/app.blendsky.document/…" />
          <button type="button" id="forum-import-btn" class="btn btn-secondary">Import document</button>
        </div>
      </div>
    </section>

    <!-- Bluesky -->
    <section id="view-bluesky" class="view">
      <div class="bluesky-header">
        <h2>Bluesky feed</h2>
        <p class="bluesky-desc">Posts from everyone you follow. Connect your account to load your timeline.</p>
      </div>
      <div id="bluesky-connect" class="bluesky-connect">
        <form id="bluesky-login-form" class="bluesky-login-form">
          <input type="text" id="bluesky-handle" placeholder="you.bsky.social" required />
          <input type="password" id="bluesky-app-password" class="bluesky-app-password hidden" placeholder="App password" autocomplete="off" />
          <button type="submit" class="btn btn-primary">Connect</button>
        </form>
        <p class="bluesky-hint" id="bluesky-hint-serverless">Use an <a href="https://bsky.app/settings/app-passwords" target="_blank" rel="noopener">app password</a> (no backend needed — works on GitHub Pages).</p>
        <p class="bluesky-hint hidden" id="bluesky-hint-oauth">With a server (apiBase in config.json): OAuth redirect; otherwise app password above.</p>
      </div>
      <div id="bluesky-feed-wrap" class="bluesky-feed-wrap hidden">
        <div class="bluesky-feed-header">
          <span id="bluesky-user"></span>
          <button type="button" id="bluesky-disconnect" class="btn btn-ghost">Disconnect</button>
        </div>
        <div id="bluesky-feed" class="bluesky-feed"></div>
        <button type="button" id="bluesky-load-more" class="btn btn-secondary hidden">Load more</button>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <p>blendsky — Forum for Blender users sharing JSON geometry node setups</p>
  </footer>

  <script src="blendsky-lexicon.js"></script>
  <script src="app.js"></script>
</body>
</html>
