<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#2563eb" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="blendsky" />
  <title>blendsky ‚Äî Forum for Blender users sharing JSON geometry node setups</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;1,9..144,400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="site-header-main">
      <a href="#" class="logo" data-nav="home">
        <span class="logo-mark">blend</span><span class="logo-dot">sky</span>
      </a>
      <p class="tagline">Blender users sharing JSON geometry node setups</p>
      <nav class="main-nav">
        <a href="#" class="nav-link" data-nav="wiki">Wiki</a>
        <a href="#" class="nav-link" data-nav="forum">Forum</a>
        <a href="#" class="nav-link" data-nav="bluesky">Bluesky</a>
        <span id="header-login-wrap" class="header-auth-wrap">
          <a href="#" id="header-login-link" class="nav-link" data-nav="bluesky">Log in</a>
        </span>
        <span id="header-user-wrap" class="header-auth-wrap hidden">
          <span class="header-user-label">Logged in as</span>
          <a href="#" id="header-user-link" class="nav-link header-user-handle" data-nav="bluesky"></a>
        </span>
      </nav>
    </div>
    <p class="app-version-wrap" aria-label="Blendsky version"><span id="app-version" class="app-version muted"></span></p>
  </header>

  <main class="main">
    <!-- Home -->
    <section id="view-home" class="view view-active">
      <section class="home-section home-recent-section">
        <div class="home-recent-header">
          <h2 class="home-section-title">Recent forum posts &amp; wiki articles</h2>
          <button type="button" id="home-recent-refresh" class="btn btn-ghost btn-sm" title="Reload posts from other users">Refresh</button>
        </div>
        <p id="home-recent-desc" class="home-section-desc muted">Posts from other users who synced to the blendsky forum or wiki.</p>
        <div id="home-recent-feed" class="home-recent-feed"></div>
      </section>

      <section class="home-section home-carousel-section">
        <h2 class="home-section-title">Trending #b3d</h2>
        <p class="home-section-desc muted">Recent Blender posts on Bluesky.</p>
        <div class="home-carousel-wrap">
          <div id="home-discover-feed" class="home-carousel-track">
            <p class="muted" id="home-discover-loading">Loading‚Ä¶</p>
          </div>
          <a href="https://bsky.app/search?q=%23b3d" target="_blank" rel="noopener" class="home-carousel-more">See more #b3d on Bluesky ‚Üí</a>
        </div>
      </section>

      <section id="home-bluesky-section" class="home-section home-feed-section hidden">
        <h2 class="home-section-title">Your Bluesky feed</h2>
        <p class="home-section-desc muted">Posts from people you follow.</p>
        <div id="home-bluesky-feed" class="home-bluesky-feed"></div>
        <button type="button" id="home-bluesky-load-more" class="btn btn-secondary hidden">Load more</button>
      </section>

      <section class="home-section home-actions">
        <p class="home-actions-lead">Wiki ¬∑ Forum ¬∑ Bluesky</p>
        <p class="home-actions-sub muted">Document node setups, share threads, and connect your feed.</p>
        <nav class="home-actions-nav">
          <a href="#" class="btn btn-primary" data-nav="wiki">Wiki</a>
          <a href="#" class="btn btn-secondary" data-nav="forum">Forum</a>
          <a href="#" class="btn btn-secondary" data-nav="bluesky">Bluesky</a>
        </nav>
      </section>
    </section>

    <!-- Wiki (Wikipedia-style) -->
    <section id="view-wiki" class="view view-wiki">
      <div class="wiki-toolbar wiki-toolbar-wikipedia">
        <div class="wiki-toolbar-inner">
          <input type="text" id="wiki-search" class="wiki-search" placeholder="Search or create page‚Ä¶" />
          <button type="button" id="wiki-new" class="btn btn-primary">New page</button>
        </div>
      </div>
      <div class="wiki-content wiki-content-wikipedia">
        <aside class="wiki-sidebar wiki-sidebar-wikipedia">
          <div class="wiki-sidebar-inner">
            <h3 class="wiki-sidebar-title">Contents</h3>
            <ul id="wiki-list" class="wiki-list"></ul>
          </div>
        </aside>
        <article class="wiki-main wiki-main-wikipedia">
          <div id="wiki-view" class="wiki-view">
            <h1 id="wiki-title"></h1>
            <p id="wiki-sync-status" class="sync-status" aria-live="polite"></p>
            <p id="wiki-byline" class="wiki-byline muted" aria-live="polite"></p>
            <p class="wiki-edits-hint muted"><small>Remix creates a fork. Suggest edit adds your proposed change below for the author to see.</small></p>
            <div id="wiki-body" class="wiki-body"></div>
            <div class="wiki-view-actions">
              <button type="button" id="wiki-edit-btn" class="btn btn-primary">Edit</button>
              <button type="button" id="wiki-remix" class="btn btn-secondary">Remix</button>
              <button type="button" id="wiki-history-btn" class="btn btn-ghost">History</button>
              <button type="button" id="wiki-suggest-edit" class="btn btn-ghost hidden">Suggest</button>
              <span id="wiki-sync-wrap" class="wiki-sync-wrap"></span>
            </div>
            <section id="wiki-suggested-edits" class="wiki-suggested-edits hidden">
              <h3>Suggested edits</h3>
              <p class="wiki-suggested-edits-hint muted"><small>Propose a change for the author. It will appear here.</small></p>
              <ul id="wiki-suggested-edits-list" class="wiki-suggested-edits-list"></ul>
              <form id="wiki-suggest-edit-form" class="wiki-suggest-edit-form hidden">
                <textarea id="wiki-suggest-edit-body" placeholder="Describe or paste your suggested change‚Ä¶" rows="4"></textarea>
                <button type="submit" class="btn btn-primary">Submit suggestion</button>
                <button type="button" id="wiki-suggest-edit-cancel" class="btn btn-ghost">Cancel</button>
              </form>
            </section>
            <section class="wiki-discussion">
              <h3>Discussion</h3>
              <p class="wiki-discussion-hint muted"><small>Reply to this article. Quote a reply to reference it.</small></p>
              <ul id="wiki-replies-list" class="wiki-replies-list"></ul>
              <form id="wiki-reply-form" class="wiki-reply-form">
                <textarea id="wiki-reply-body" placeholder="Write a reply‚Ä¶" rows="3"></textarea>
                <button type="submit" class="btn btn-primary">Reply</button>
              </form>
            </section>
          </div>
          <div id="wiki-history-panel" class="wiki-history-panel hidden">
            <div class="wiki-history-header">
              <h3>Edit history</h3>
              <button type="button" id="wiki-history-close" class="btn btn-ghost">Close</button>
            </div>
            <ul id="wiki-history-list" class="wiki-history-list"></ul>
            <div id="wiki-diff-view" class="wiki-diff-view hidden">
              <h4 id="wiki-diff-title" class="wiki-diff-title"></h4>
              <div id="wiki-diff-body" class="wiki-diff-body"></div>
            </div>
          </div>
          <div id="wiki-edit" class="wiki-edit hidden">
            <input type="text" id="wiki-edit-title" class="wiki-edit-title" placeholder="Page title" />
            <textarea id="wiki-edit-body" class="wiki-edit-body" placeholder="Write in Markdown‚Ä¶"></textarea>
            <div class="wiki-edit-actions">
              <button type="button" id="wiki-save" class="btn btn-primary">Save</button>
              <button type="button" id="wiki-cancel" class="btn btn-ghost">Cancel</button>
            </div>
          </div>
        </article>
      </div>
      <div id="wiki-from-others" class="wiki-from-others">
        <div class="wiki-from-others-header">
          <h3>Wiki articles from others</h3>
          <button type="button" id="wiki-from-others-refresh" class="btn btn-ghost btn-sm" title="Reload articles from everyone">Refresh</button>
        </div>
        <p class="wiki-from-others-hint muted">Articles from Standard.site (<code>site.standard.document</code>) and Bluesky #blendsky-wiki so you can find each other‚Äôs wikis. Click a card or <strong>Open in Wiki</strong> to view, reply, edit your copy, or <strong>Suggest edit</strong>. Use <strong>Remix</strong> to fork. Sync your pages from this app URL so others see them; click <strong>Refresh</strong> to load.</p>
        <div id="wiki-from-others-feed" class="wiki-from-others-feed"><p class="muted" id="wiki-from-others-loading">Loading‚Ä¶</p></div>
      </div>
    </section>

    <!-- Forum -->
    <section id="view-forum" class="view">
      <div class="forum-toolbar">
        <h2>Forum</h2>
        <p class="forum-tagline">Synced across accounts ‚Äî share and remix Blender tutorials. Start a thread, sync to Bluesky, and the community sees it. Geometry node JSON is optional.</p>
        <button type="button" id="forum-new-thread" class="btn btn-primary">New thread</button>
      </div>
      <div id="forum-discover" class="forum-discover">
        <div class="forum-discover-header">
          <h3>Community forum</h3>
          <button type="button" id="forum-discover-refresh-btn" class="btn btn-ghost btn-sm forum-discover-refresh-btn" title="Reload threads from everyone">Refresh</button>
        </div>
        <p class="forum-discover-hint muted">Threads from Standard.site (<code>site.standard.document</code>) and Bluesky #blendsky-forum so you can find each other's posts. Click a thread to open it. Use <strong>Remix</strong> to copy and adapt. Sync your threads from this app URL so others see them; click <strong>Refresh</strong> to load.</p>
        <div id="forum-discover-feed" class="forum-discover-feed"><p class="muted" id="forum-discover-loading">Loading‚Ä¶</p></div>
      </div>
      <h3 id="forum-your-threads-title" class="forum-your-threads-title">My threads</h3>
      <div id="forum-thread-list" class="forum-thread-list"></div>
      <div id="forum-thread-view" class="forum-thread-view hidden">
        <button type="button" id="forum-back" class="btn btn-ghost">‚Üê Back to threads</button>
        <article id="forum-thread-detail"></article>
        <div id="forum-thread-standard" class="forum-thread-standard hidden">
          <button type="button" id="forum-edit-thread-btn" class="btn btn-primary">Edit</button>
          <button type="button" id="forum-sync-bluesky" class="btn btn-secondary">Sync</button>
          <button type="button" id="forum-export-standard" class="btn btn-ghost" title="Export as document">Export</button>
        </div>
        <section class="forum-replies">
          <h3>Replies</h3>
          <p class="forum-replies-hint muted"><small>Quote a reply to reference it. Replies stay in the blendsky forum. Add images with the button below.</small></p>
          <ul id="forum-replies-list"></ul>
          <form id="forum-reply-form" class="forum-reply-form">
            <textarea id="forum-reply-body" placeholder="Write a reply‚Ä¶" rows="3"></textarea>
            <p class="form-actions-inline">
              <input type="file" id="forum-reply-image" accept="image/jpeg,image/png,image/gif,image/webp" class="forum-image-input" />
              <label for="forum-reply-image" class="btn btn-secondary forum-upload-label">Add image</label>
            </p>
            <button type="submit" class="btn btn-primary">Reply</button>
          </form>
        </section>
      </div>
      <div id="forum-new-view" class="forum-new-view hidden">
        <button type="button" id="forum-new-cancel" class="btn btn-ghost">‚Üê Cancel</button>
        <form id="forum-new-form" class="forum-new-form">
          <label class="form-label">Title</label>
          <input type="text" id="forum-new-title" class="form-input" placeholder="What's this thread about?" required />
          <label class="form-label">Your post</label>
          <textarea id="forum-new-body" class="form-input form-textarea" placeholder="What's on your mind? You can paste a geometry node JSON or add images." rows="5"></textarea>
          <p class="form-actions-inline">
            <input type="file" id="forum-new-image" accept="image/jpeg,image/png,image/gif,image/webp" class="forum-image-input" />
            <label for="forum-new-image" class="btn btn-secondary forum-upload-label">Add image</label>
          </p>
          <p class="form-hint muted">This will appear on the forum. Sync to Bluesky to share it there.</p>
          <details class="form-optional">
            <summary>Optional</summary>
            <label class="form-label form-label-optional">Link name</label>
            <input type="text" id="forum-new-path" class="form-input form-input-optional" placeholder="Short name for the link (e.g. my-setup)" />
            <label class="form-label form-label-optional">Short description</label>
            <textarea id="forum-new-description" class="form-input form-input-optional" placeholder="One line summary" rows="2"></textarea>
            <label class="form-label form-label-optional">Tags</label>
            <input type="text" id="forum-new-tags" class="form-input form-input-optional" placeholder="blender, nodes" />
          </details>
          <button type="submit" class="btn btn-primary">Create thread</button>
        </form>
      </div>
      <div id="forum-edit-view" class="forum-edit-view hidden">
        <button type="button" id="forum-edit-cancel" class="btn btn-ghost">‚Üê Cancel</button>
        <form id="forum-edit-form" class="forum-edit-form">
          <label class="form-label">Title</label>
          <input type="text" id="forum-edit-title" class="form-input" placeholder="Thread title" required />
          <label class="form-label">Your post</label>
          <textarea id="forum-edit-body" class="form-input form-textarea" placeholder="Your post or geometry node JSON" rows="5"></textarea>
          <p class="form-actions-inline">
            <input type="file" id="forum-edit-image" accept="image/jpeg,image/png,image/gif,image/webp" class="forum-image-input" />
            <label for="forum-edit-image" class="btn btn-secondary forum-upload-label">Add image</label>
          </p>
          <details class="form-optional">
            <summary>Optional</summary>
            <input type="text" id="forum-edit-path" class="form-input form-input-optional" placeholder="Link name" />
            <textarea id="forum-edit-description" class="form-input form-input-optional" placeholder="Short description" rows="2"></textarea>
            <input type="text" id="forum-edit-tags" class="form-input form-input-optional" placeholder="Tags" />
          </details>
          <button type="submit" class="btn btn-primary">Save & sync to Bluesky</button>
        </form>
      </div>
      <div class="forum-import-export">
        <p class="forum-std-hint">Import forum or wiki documents from the AT Protocol. Paste an AT URI (<strong>site.standard.document</strong>, <a href="https://standard.site" target="_blank" rel="noopener">Standard.site</a>).</p>
        <div class="forum-import-row">
          <input type="text" id="forum-import-uri" placeholder="at://did:plc:‚Ä¶/site.standard.document/‚Ä¶" />
          <button type="button" id="forum-import-btn" class="btn btn-secondary">Import document</button>
        </div>
      </div>
    </section>

    <!-- Bluesky -->
    <section id="view-bluesky" class="view">
      <div class="bluesky-header">
        <h2>Bluesky feed</h2>
        <p class="bluesky-desc">Posts from everyone you follow. Connect your account to load your timeline.</p>
      </div>
      <div id="bluesky-connect" class="bluesky-connect">
        <form id="bluesky-login-form" class="bluesky-login-form">
          <input type="text" id="bluesky-handle" placeholder="you.bsky.social" required />
          <input type="password" id="bluesky-app-password" class="bluesky-app-password hidden" placeholder="App password" autocomplete="off" />
          <button type="submit" class="btn btn-primary">Connect</button>
        </form>
        <p class="bluesky-hint" id="bluesky-hint-serverless">Use an <a href="https://bsky.app/settings/app-passwords" target="_blank" rel="noopener">app password</a> (no backend needed ‚Äî works on GitHub Pages).</p>
        <p class="bluesky-hint hidden" id="bluesky-hint-oauth">With a server (apiBase in config.json): OAuth redirect; otherwise app password above.</p>
      </div>
      <div id="bluesky-feed-wrap" class="bluesky-feed-wrap hidden">
        <div class="bluesky-feed-header">
          <span id="bluesky-user"></span>
          <button type="button" id="bluesky-disconnect" class="btn btn-ghost">Disconnect</button>
        </div>
        <div id="bluesky-feed" class="bluesky-feed"></div>
        <button type="button" id="bluesky-load-more" class="btn btn-secondary hidden">Load more</button>
      </div>
    </section>
  </main>

  <!-- Mobile bottom nav (PWA / iPhone-friendly) -->
  <nav class="bottom-nav" aria-label="Main">
    <a href="#" class="bottom-nav-link" data-nav="home">
      <span class="bottom-nav-icon" aria-hidden="true">‚åÇ</span>
      <span class="bottom-nav-label">Home</span>
    </a>
    <a href="#" class="bottom-nav-link" data-nav="wiki">
      <span class="bottom-nav-icon" aria-hidden="true">üìñ</span>
      <span class="bottom-nav-label">Wiki</span>
    </a>
    <a href="#" class="bottom-nav-link" data-nav="forum">
      <span class="bottom-nav-icon" aria-hidden="true">üí¨</span>
      <span class="bottom-nav-label">Forum</span>
    </a>
    <a href="#" class="bottom-nav-link" data-nav="bluesky">
      <span class="bottom-nav-icon" aria-hidden="true">‚òÅ</span>
      <span class="bottom-nav-label">Bluesky</span>
    </a>
  </nav>

  <!-- On-site post viewer (community thread from Bluesky search) -->
  <div id="post-viewer-overlay" class="post-viewer-overlay hidden" aria-hidden="true">
    <div class="post-viewer-backdrop" id="post-viewer-backdrop"></div>
    <div class="post-viewer-sheet" id="post-viewer-sheet" role="dialog" aria-labelledby="post-viewer-title" aria-modal="true">
      <div class="post-viewer-header">
        <h2 id="post-viewer-title" class="post-viewer-title"></h2>
        <p class="post-viewer-byline muted"></p>
        <button type="button" class="post-viewer-close btn btn-ghost" id="post-viewer-close" aria-label="Close">Done</button>
      </div>
      <div id="post-viewer-body" class="post-viewer-body"></div>
    </div>
  </div>

  <footer class="site-footer">
    <p>blendsky ‚Äî Forum for Blender users sharing JSON geometry node setups</p>
  </footer>

  <script src="blendsky-lexicon.js"></script>
  <script src="app.js"></script>
</body>
</html>
